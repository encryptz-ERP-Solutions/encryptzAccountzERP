<div class="doted-theme z-1"></div>
<div class="hero-banner">
  <div class="hero-text">
    <div class="hero-greeting">Hi, {{ greetingName }}</div>
    <div class="hero-subtitle">
      Welcome to <span class="brand">encryptz</span> workspace
    </div>
    <div class="hero-helper">Select a business to continue where you left off.</div>
  </div>
  <div class="hero-actions">
    <button mat-icon-button [matMenuTriggerFor]="userMenu" matTooltip="User menu">
      <mat-icon>account_circle</mat-icon>
    </button>
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item (click)="logout()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
  </div>
</div>

<mat-card class="modules-data py-5">
  <div class="container">
    <div class="workspace-grid">
      <section class="workspace-column">
        <div class="section-heading">
          <div>
            <div class="eyebrow">Step 1</div>
            <h2>Your businesses</h2>
          </div>
          <div class="heading-actions">
            <button mat-flat-button color="primary" class="create-btn" (click)="openCreateBusinessDialog()">
              <mat-icon class="icon-14 mrR-6">add</mat-icon>
              Create business
            </button>
            <button mat-stroked-button color="primary" class="change-btn" *ngIf="selectedBusiness" (click)="clearSelection()">
              Change selection
            </button>
          </div>
        </div>

        <div class="state-container" *ngIf="isLoadingBusinesses">
          <mat-progress-spinner mode="indeterminate" diameter="36"></mat-progress-spinner>
          <p class="state-text mt-2">Loading businesses...</p>
        </div>

        <div class="state-container" *ngIf="!isLoadingBusinesses && !businesses.length">
          <mat-icon class="state-icon">business</mat-icon>
          <p class="state-text">No businesses are linked to your account yet. Please contact your administrator.</p>
        </div>

        <div class="business-grid" *ngIf="!isLoadingBusinesses && businesses.length">
          <mat-card
            class="business-card"
            appearance="outlined"
            *ngFor="let business of businesses"
            (click)="selectBusiness(business)"
            [ngClass]="{'selected': selectedBusiness?.userBusinessID === business.userBusinessID}"
          >
            <div class="business-card-header">
              <div class="avatar">{{ business.businessName?.charAt(0) || 'B' }}</div>
              <div class="business-meta">
                <div class="business-name">{{ business.businessName || 'Untitled business' }}</div>
                <div class="business-code" *ngIf="business.businessCode">
                  {{ business.businessCode }}
                </div>
              </div>
              <mat-chip color="primary" *ngIf="business.isDefault" class="chip-default" selected>Default</mat-chip>
            </div>
            <div class="business-footer">
              <span>{{ business.userBusinessID | slice:0:8 }}</span>
              <mat-icon>arrow_forward</mat-icon>
            </div>
          </mat-card>
        </div>
      </section>

      <section class="workspace-column">
        <div class="section-heading">
          <div>
            <div class="eyebrow">Step 2</div>
            <h2>Select a module</h2>
            <p class="helper" *ngIf="selectedBusiness">
              Showing modules for <strong>{{ selectedBusiness.businessName || 'business' }}</strong>
            </p>
          </div>
        </div>

        <div class="state-container" *ngIf="!selectedBusiness">
          <mat-icon class="state-icon">touch_app</mat-icon>
          <p class="state-text">Pick a business to unlock the modules available to you.</p>
        </div>

        <div class="modules-grid" *ngIf="selectedBusiness">
          <mat-card
            class="module-card"
            appearance="outlined"
            *ngFor="let module of modules"
            (click)="openModule(module)"
          >
            <div class="module-icon">
              <mat-icon>{{ module.icon }}</mat-icon>
            </div>
            <div class="module-body">
              <div class="module-title">
                {{ module.title }}
                <mat-chip color="accent" *ngIf="module.badge" selected>{{ module.badge }}</mat-chip>
              </div>
              <p>{{ module.description }}</p>
            </div>
            <mat-icon class="module-arrow">north_east</mat-icon>
          </mat-card>
        </div>
      </section>
    </div>
  </div>
</mat-card>